<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
<p id="loginStatus">Uitgelogd</p>
<button type="button" onclick="logout()">Log Out!</button>


<form id="loginForm">
    <p style="border: 1px solid black; padding: 8px; background: skyblue; text-align: center">Log in!</p>
    <hr>
    <label>
        User Name: *
        <input type="text" name="username" id="username" placeholder="postgres">
    </label>
    <label>
        Password: *
        <input type="text" name="password" id="password" placeholder="root">
    </label>
    <button type="button" onclick="submitLoginForm()">Log in</button>

    <br> <br>
    <br>

    <hr/>
    <p style="border: 1px solid black; padding: 8px; background: skyblue; text-align: center">Get users!</p>
    <button type="button" onclick="getUserList()">Get user list!</button>
    <div id="user-list"></div>
    <br><br><br>
    <hr>
    <button type="button" onclick="getSession()">Get Session!</button>

</form>

<script>
    const submitLoginForm = () => {
            const url = "http://localhost:8081/api/v1/login";
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            fetch(url,
                {method: "POST", headers: {'Content-Type': 'application/json'}, body: JSON.stringify({username, password})}
            ).then(response =>response.json())
                .then(data => {
                    document.querySelector("#loginStatus").innerHTML = data
                })
                .catch(error => console.error("Error occurred", error))
        }
    ;

    const getUserList = () => {
        const url = "http://localhost:8081/api/v1/user";

        fetch(url, {method: "GET", headers: {'withCredentials': 'true'}})
            .then(response => response.json())
            .then(body => document.querySelector("#user-list").innerHTML = JSON.stringify(body))
            .catch(error => console.error("Error occurred", error))
    };

    const getSession = () => {
        const url = 'http://localhost:8081/api/v1/session';

        fetch(url, {method: "GET", headers: {'withCredentials': 'true'}})
            .then(response => response.json())
                .then(body => console.log(body))
                    .catch(error => console.error("Error occurred", error));

    };


    const logout = () => {
        const url = 'http://localhost:8081/api/v1/login/logout';

        fetch(url, {method: "GET", headers: {'withCredentials': 'true'}})
            .then(response => response.json())
            .then(body => {
                document.querySelector('#loginStatus').innerHTML = 'Uitgelogd';
            })
            .catch(error => console.error("Error occurred", error));

    };
</script>
</body>
</html>